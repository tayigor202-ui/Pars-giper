{% extends "base.html" %}

{% block title %}Управление - Analytics{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="page-title">Управление</h1>
        <p class="page-subtitle">Запуск и остановка процессов парсинга.</p>
    </div>
</div>

<div class="row align-items-stretch">
    <div class="col-lg-5">
        <div class="main-card h-100">
            <h3 class="h5 mb-4 fw-bold">Командный центр</h3>

            <div class="d-grid gap-3 mb-4">
                <button id="start-parser-btn" class="btn btn-action py-3">
                    <i class="bi bi-play-fill me-2"></i> Запуск Ozon
                </button>
                <button id="start-wb-parser-btn" class="btn btn-action py-3" style="background: #a855f7;">
                    <i class="bi bi-play-fill me-2"></i> Запуск WB
                </button>
                <button id="stop-parser-btn" class="btn btn-outline-danger py-3 border-2 rounded-4">
                    <i class="bi bi-stop-fill me-2"></i> Остановить всё
                </button>
            </div>

            <div id="status-message" class="mt-auto"></div>
        </div>
    </div>

    <div class="col-lg-7">
        <div class="main-card h-100 bg-black bg-opacity-50">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="h5 mb-0 fw-bold">Терминал</h3>
                <i class="bi bi-terminal text-secondary"></i>
            </div>

            <div id="mini-log" class="font-monospace small p-3"
                style="height: 300px; overflow-y: auto; color: #94a3b8; background: rgba(0,0,0,0.3); border-radius: 12px;">
                <span class="text-secondary">[SYSTEM]</span> Ожидание команды пользователя...
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const log = document.getElementById('mini-log');
    function addLog(msg, type = 'INFO') {
        const time = new Date().toLocaleTimeString();
        log.innerHTML += `<div class="mb-1"><span class="text-secondary">[${time}]</span> <span class="text-${type === 'ERROR' ? 'danger' : 'secondary'}">[${type}]</span> ${msg}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    document.getElementById('start-parser-btn').addEventListener('click', function () {
        addLog('Запрос на запуск Ozon отправлен...');
        fetch('/api/parser/start', { method: 'POST' })
            .then(r => r.json())
            .then(data => addLog(data.message, data.status === 'success' ? 'SUCCESS' : 'ERROR'));
    });

    document.getElementById('start-wb-parser-btn').addEventListener('click', function () {
        addLog('Запрос на запуск WB отправлен...');
        fetch('/api/wb/parser/start', { method: 'POST' })
            .then(r => r.json())
            .then(data => addLog(data.message, data.status === 'success' ? 'SUCCESS' : 'ERROR'));
    });

    document.getElementById('stop-parser-btn').addEventListener('click', function () {
        addLog('Остановка процессов...');
        fetch('/api/parser/stop', { method: 'POST' })
            .then(r => r.json())
            .then(data => addLog(data.message, 'WARNING'));
    });
</script>
{% endblock %}